From 228c626a25055e80edb7e35e218c084cc499cf03 Mon Sep 17 00:00:00 2001
From: Andrew Branson <andrew.branson@jolla.com>
Date: Tue, 7 Apr 2020 00:02:45 +0200
Subject: [PATCH] Enable gstreamer pipeline debug graph generation. JB#49532

---
 dom/media/gstreamer/GStreamerFunctionList.h | 1 +
 dom/media/gstreamer/GStreamerReader.cpp     | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/dom/media/gstreamer/GStreamerFunctionList.h b/dom/media/gstreamer/GStreamerFunctionList.h
index 827e61086e6f..ac6d66a6aaa7 100644
--- a/dom/media/gstreamer/GStreamerFunctionList.h
+++ b/dom/media/gstreamer/GStreamerFunctionList.h
@@ -36,6 +36,7 @@ GST_FUNC(LIBGSTREAMER, gst_caps_new_empty)
 GST_FUNC(LIBGSTREAMER, gst_caps_new_full)
 GST_FUNC(LIBGSTREAMER, gst_caps_new_simple)
 GST_FUNC(LIBGSTREAMER, gst_caps_set_simple)
+GST_FUNC(LIBGSTREAMER, gst_debug_bin_to_dot_file_with_ts)
 GST_FUNC(LIBGSTREAMER, gst_element_factory_get_static_pad_templates)
 GST_FUNC(LIBGSTREAMER, gst_element_factory_get_type)
 GST_FUNC(LIBGSTREAMER, gst_element_factory_make)
diff --git a/dom/media/gstreamer/GStreamerReader.cpp b/dom/media/gstreamer/GStreamerReader.cpp
index f693cae077de..62dc770cd645 100644
--- a/dom/media/gstreamer/GStreamerReader.cpp
+++ b/dom/media/gstreamer/GStreamerReader.cpp
@@ -612,6 +612,9 @@ nsresult GStreamerReader::ReadMetadata(MediaInfo* aInfo,
    * the appsinks */
   if (UpdateCurrentAsActiveIfNotBusy(this)) {
     gst_element_set_state(mPlayBin, GST_STATE_PLAYING);
+    GST_DEBUG_BIN_TO_DOT_FILE_WITH_TS(GST_BIN(mPlayBin),
+                                       GstDebugGraphDetails(GST_DEBUG_GRAPH_SHOW_ALL /* GST_DEBUG_GRAPH_SHOW_MEDIA_TYPE | GST_DEBUG_GRAPH_SHOW_NON_DEFAULT_PARAMS | GST_DEBUG_GRAPH_SHOW_STATES*/),
+                                       "ReadMetadata");
   }
 
   return NS_OK;
-- 
2.26.2

