From 4da6b85348aa63cb3ddbfb98b4608f1ab2c3fbce Mon Sep 17 00:00:00 2001
From: Raine Makelainen <raine.makelainen@jolla.com>
Date: Tue, 10 Mar 2020 15:06:39 +0200
Subject: [PATCH] Handle temporary directory similarly as in MacOSX

Signed-off-by: Raine Makelainen <raine.makelainen@jolla.com>
---
 uriloader/exthandler/nsExternalHelperAppService.cpp | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/uriloader/exthandler/nsExternalHelperAppService.cpp b/uriloader/exthandler/nsExternalHelperAppService.cpp
index fc2f2385643b..8c982e59e071 100644
--- a/uriloader/exthandler/nsExternalHelperAppService.cpp
+++ b/uriloader/exthandler/nsExternalHelperAppService.cpp
@@ -284,7 +284,7 @@ static nsresult GetDownloadDirectory(nsIFile **_directory,
                                      bool aSkipChecks = false)
 {
   nsCOMPtr<nsIFile> dir;
-#ifdef XP_MACOSX
+#if defined(XP_MACOSX) || defined(XP_UNIX)
   // On OS X, we first try to get the users download location, if it's set.
   switch (Preferences::GetInt(NS_PREF_DOWNLOAD_FOLDERLIST, -1)) {
     case NS_FOLDER_VALUE_DESKTOP:
@@ -321,8 +321,14 @@ static nsresult GetDownloadDirectory(nsIFile **_directory,
   }
 
   if (!dir) {
+#if defined(XP_MACOSX)
+      const char* specialDirName = NS_OSX_DEFAULT_DOWNLOAD_DIR;
+#else
+      const char* specialDirName = NS_UNIX_DEFAULT_DOWNLOAD_DIR;
+#endif
+
     // If not, we default to the OS X default download location.
-    nsresult rv = NS_GetSpecialDirectory(NS_OSX_DEFAULT_DOWNLOAD_DIR,
+    nsresult rv = NS_GetSpecialDirectory(specialDirName,
                                          getter_AddRefs(dir));
     NS_ENSURE_SUCCESS(rv, rv);
   }
-- 
2.26.2

